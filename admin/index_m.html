<html>

<head>
    <!-- Load ioBroker scripts and styles-->
    <link rel="stylesheet" type="text/css" href="../../lib/css/fancytree/ui.fancytree.min.css" />
    <link rel="stylesheet" type="text/css" href="../../css/adapter.css" />
    <link rel="stylesheet" type="text/css" href="../../lib/css/materialize.css">

    <script type="text/javascript" src="../../lib/js/jquery-3.2.1.min.js"></script>
    <script type="text/javascript" src="../../socket.io/socket.io.js"></script>

    <script type="text/javascript" src="../../lib/js/materialize.js"></script>
    <script type="text/javascript" src="../../lib/js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="../../lib/js/jquery.fancytree-all.min.js"></script>

    <script type="text/javascript" src="../../js/translate.js"></script>
    <script type="text/javascript" src="../../lib/js/selectID.js"></script>
    <script type="text/javascript" src="../../js/adapter-settings.js"></script>


    <!-- my own styles -->
    <link rel="stylesheet" type="text/css" href="style.css" />
    <script type="text/javascript" src="words.js"></script>


    <style>

        #dialog-room-edit {
            max-height: 95% !important;
            max-width: 85% !important;
            width: 80% !important;
            height: 90% !important;
            overflow: visible !important;
            top: 10px !important;
        }

        #dialog-select-member {
            max-height: 95% !important;
            max-width: 85% !important;
            width: 80% !important;
            height: 90% !important;
            overflow: visible !important;
            top: 10px !important;
        }

        .collapsible-body {
            margin-left: 2rem !important;
            padding-top: 0 !important;
        }

        redlabel {
            color: red;
        }
    </style>

    <script type="text/javascript">

        //==========================================================================
        //load / save profile
        function SaveProfile(instance) {
            console.log('SaveProfile called ');
            $('#checkResultSaveProfile').html("saving...");

            sendTo(instance, 'saveProfile', null, function (result) {

                generateFile('heatingcontrol_profile.json', result);

                console.log('profile saved ');

                $('#checkResultSaveProfile').html("profile saved");
            });


        }


        function generateFile(filename, obj) {
            var el = document.createElement('a');
            el.setAttribute('href', 'data:application/json;charset=utf-8,' + encodeURIComponent(JSON.stringify(obj, null, 2)));
            el.setAttribute('download', filename);

            el.style.display = 'none';
            document.body.appendChild(el);

            el.click();

            document.body.removeChild(el);
        }



        function LoadProfile(instance) {
            console.log('Load profile called');

            var input = document.createElement('input');
            input.setAttribute('type', 'file');
            input.setAttribute('id', 'files');
            input.setAttribute('opacity', 0);
            input.addEventListener('change', function (e) {
                handleFileSelect(e, instance, function () { });
            }, false);
            (input.click)();
        }

        function handleFileSelect(evt, instance) {

            console.log('handleFileSelect ' + instance);

            var f = evt.target.files[0];

            if (f) {
                var r = new FileReader();
                r.onload = function (e) {
                    var contents = e.target.result;

                    $('#checkResultLoadProfile').html("loading...");

                    sendTo(instance, 'loadProfile', contents, function (result) {

                        console.log('profile loaded with ' + result);

                        $('#checkResultLoadProfile').html(result);
                        onChange(true);
                    });
                }

                r.readAsText(f);
            }
        }

        //==========================================================================

        function DeleteUnusedConfig() {



            $('#result_deleteunusedConfig').html("not implemented yet");
        }

        //==========================================================================
        function findObjectIdByKey(array, key, value) {

            //Achtung: key wird auf int geparsed!!

            if (array !== null && typeof array !== 'undefined') {

                for (let i = 0; i < array.length; i++) {

                    let val1 = array[i][key];
                    if (typeof array[i][key] !== 'number') {
                        val1 = parseInt(array[i][key]);
                    }

                    let val2 = value;

                    console.log('check for ' + val1 + ' (' + typeof val1 + ') and ' + val2 + ' (' + typeof val2 + ')');
                    if (val1 === val2) {
                        console.log('found');
                        return i;
                    }
                }
            }

            console.log('not found');
            return -1;
        }


        function show_hide_column(table_name, col_name, col_no, do_show) {

            //this is only for header
            var element = document.getElementById(col_name);

            if (do_show) {
                element.classList.remove("hide");
            }
            else {
                element.classList.add("hide");
            }

            //here we have all other rows
            var tbl = document.getElementById(table_name);
            var rows = tbl.getElementsByTagName('tr');

            for (var row = 0; row < rows.length; row++) {
                var cols = rows[row].children;
                if (col_no >= 0 && col_no < cols.length) {
                    var cell = cols[col_no];
                    if (cell.tagName == 'TD' || cell.tagName == 'TH') {
                        if (do_show) {
                            cell.classList.remove("hide");
                        }
                        else {
                            cell.classList.add("hide");
                        }
                    }
                }
            }
        }


        var AdapterIsOnline = false;

        function showHideSettings() {

            //always hide

            if (!AdapterIsOnline) {
                $('.col-adapternotonline').show();
            }
            else {
                $('.col-adapternotonline').hide();
            }


            var TypeDPPresent = $('#Path2PresentDPType')[0].value
            if (TypeDPPresent == 1) {
                $('.col_Path2PresentDPLimit').hide();
            }
            else {
                $('.col_Path2PresentDPLimit').show();
            }

            var TypeDPGuestPresent = $('#Path2GuestsPresentDPType')[0].value
            if (TypeDPGuestPresent == 1) {
                $('.col_Path2GuestsPresentDPLimit').hide();
            }
            else {
                $('.col_Path2GuestsPresentDPLimit').show();
            }

            var TypeDPPartyNow = $('#Path2PartyNowDPType')[0].value
            if (TypeDPPartyNow == 1) {
                $('.col_Path2PartyNowDPLimit').hide();
            }
            else {
                $('.col_Path2PartyNowDPLimit').show();
            }

            var ThermostatModeIfNoHeatingperiod = $('#ThermostatModeIfNoHeatingperiod')[0].value;

            if (ThermostatModeIfNoHeatingperiod == 2) {

                $('.col-FixTempIfNoHeatingPeriod').show();
            }
            else {
                $('.col-FixTempIfNoHeatingPeriod').hide();
            }


            var elementPageActors = document.getElementById("page-actors");
            var elementPageSensors = document.getElementById("page-sensors");

            var $useActors = $('#UseActors');
            if ($useActors.prop('checked')) {
                console.log('show actor settings');

                if (ThermostatModeIfNoHeatingperiod == 2) {
                    $('.col-useactorifnoheating').hide();
                }
                else {
                    $('.col-useactorifnoheating').show();
                }
                $('.col-useactorifnothermostat').show();
                $('.col-ActorOnDelay').show();
                $('.col-ActorOffDelay').show();

                elementPageActors.classList.remove("hide");

            }
            else {
                console.log('hide actor settings');

                $('.col-useactorifnoheating').hide();
                $('.col-useactorifnothermostat').hide();

                $('.col-ActorOnDelay').hide();
                $('.col-ActorOffDelay').hide();

                elementPageActors.classList.add("hide");

            }


            var $useSensors = $('#UseSensors');

            if ($useSensors.prop('checked')) {
                console.log('show sensor settings');

                elementPageSensors.classList.remove("hide");


                $('.col-SensorOpenDelay').show();
                $('.col-SensorCloseDelay').show();

            }
            else {
                console.log('hide sensors settings');

                elementPageSensors.classList.add("hide");

                $('.col-SensorOpenDelay').hide();
                $('.col-SensorCloseDelay').hide();
            }

            var $useFixHeatingPeriod = $('#UseFixHeatingPeriod');

            if ($useFixHeatingPeriod.prop('checked')) {
                console.log('show sensor fix heating period settings');
                $('.col-FixHeatingPeriod-Start').show();
                $('.col-FixHeatingPeriod-End').show();
            }
            else {
                console.log('hide sensor fix heating period settings');
                $('.col-FixHeatingPeriod-Start').hide();
                $('.col-FixHeatingPeriod-End').hide();
            }

            var $useVisFromPittini = $('#UseVisFromPittini');

            if ($useVisFromPittini.prop('checked')) {
                console.log('show settings for Pittini vis');
                $('.col-PittiniPathImageWindowOpen').show();
                $('.col-PittiniPathImageWindowClosed').show();

                $('.col-VisMinProfilTemp').show();
                $('.col-VisMaxProfilTemp').show();
                $('.col-VisStepWidthProfilTemp').show();


            }
            else {
                console.log('hide settings for Pittini vis');
                $('.col-PittiniPathImageWindowOpen').hide();
                $('.col-PittiniPathImageWindowClosed').hide();

                $('.col-VisMinProfilTemp').hide();
                $('.col-VisMaxProfilTemp').hide();
                $('.col-VisStepWidthProfilTemp').hide();
            }


            //first col of device tables
            show_hide_column("table_thermostats", "thermostat_col_0", 0, false);
            show_hide_column("table_actors", "actor_col_0", 0, false);
            show_hide_column("table_sensors", "sensor_col_0", 0, false);

            //third col of rooms (=WindOwpen)


        }

        var DeviceList = [];
        /*
        var timeout1;
        
        function getDevices(onChange, instance) {
            timeout1 = setTimeout(function () {
                getDevices(onChange, instance);
            }, 4000);

            //function sendTo(_adapter_instance, command, message, callback)
            sendTo(instance, 'listDevices', null, function (list) {
                if (timeout1) {
                    clearTimeout(timeout1);
                    timeout1 = null;
                }

                DeviceList = list;

                console.log('got devices ' + JSON.stringify(DeviceList));

            });
        }
*/


        var timeout2;
        function getFunctions(actualValue, onChange, instance) {
            timeout2 = setTimeout(function () {
                getFunctions(actualValue, onChange, instance);
            }, 4000);

            //function sendTo(_adapter_instance, command, message, callback)
            sendTo(instance, 'listFunctions', null, function (list) {
                if (timeout2) {
                    clearTimeout(timeout2);
                    timeout2 = null;
                }

                AdapterIsOnline = true;

                console.log('got functions ' + JSON.stringify(list));

                var $sel = $('#Gewerk');
                for (var i = 0; i < list.length; i++) {
                    $sel.append('<option value="' + list[i].name + '" ' + ((actualValue == list[i].name) ? 'selected' : '') + '>' + list[i].name + '</option>');
                }
                $sel.select();


                showHideSettings()

            });
        }


        var timeout3;
        function getRooms(onChange, instance) {
            timeout3 = setTimeout(function () {
                getRooms(onChange, instance);
            }, 4000);

            //function sendTo(_adapter_instance, command, message, callback)
            sendTo(instance, 'listRooms', true, function (obj) {
                if (timeout3) {
                    clearTimeout(timeout3);
                    timeout3 = null;
                }

                console.log('got rooms ' + JSON.stringify(obj));

                values2table('rooms', obj.list, onChange, tableRoomsOnReady);

                newRooms = obj.newRooms;

                $('#checkResultRooms').html(newRooms + ' new room(s) ');

                if (newRooms > 0) {
                    onChange(true);
                }
            });
        }

        var timeout4;
        function getThermostats(onChange, instance, room) {
            timeout4 = setTimeout(function () {
                getThermostats(onChange, instance, room);
            }, 4000);


            var gewerk = $("#Gewerk option:selected").text();

            const data = {
                room: room,
                gewerk: gewerk
            };

            console.log('get thermostats for  ' + room + " with " + gewerk + " " + JSON.stringify(data));

            //function sendTo(_adapter_instance, command, message, callback)
            sendTo(instance, 'listThermostats', data, function (result) {
                if (timeout4) {
                    clearTimeout(timeout4);
                    timeout4 = null;
                }

                console.log('got thermostats for  ' + room + " " + JSON.stringify(result));

                if (result.list.length > 0) {

                    var newThermostats = table2values('thermostats');

                    for (let i = 0; i < result.list.length; i++) {

                        const device = {
                            name: result.list[i].Name,
                            OID_Current: result.list[i].OID_Current,
                            OID_Target: result.list[i].OID_Target,
                            id: -1, //new
                            isActive: true,
                            room: result.room,
                            type: 1

                        }
                        newThermostats.push(device);
                        console.log('newThermostats  ' + JSON.stringify(newThermostats));
                    }
                    values2table('thermostats', newThermostats, OnChange, tableDevicesOnReady);
                    onChange(true);
                }
                $('#checkResultThermostats').html(result.status);

            });
        }

        var timeout5;
        function getActors(onChange, instance, room) {
            timeout5 = setTimeout(function () {
                getActors(onChange, instance, room);
            }, 4000);

            var gewerk = $("#Gewerk option:selected").text();

            const data = {
                room: room,
                gewerk: gewerk
            };

            console.log('get actors for  ' + room + " with " + gewerk + " " + JSON.stringify(data));


            //function sendTo(_adapter_instance, command, message, callback)
            sendTo(instance, 'listActors', data, function (result) {
                if (timeout5) {
                    clearTimeout(timeout5);
                    timeout5 = null;
                }

                console.log('got actors for  ' + room + " " + JSON.stringify(result));
                if (result.list.length > 0) {

                    var newActors = table2values('actors');

                    for (let i = 0; i < result.list.length; i++) {

                        const device = {
                            name: result.list[i].Name,
                            OID_Target: result.list[i].OID,
                            id: -1, //new
                            isActive: true,
                            room: result.room,
                            type: 1

                        }
                        newActors.push(device);
                        console.log('newActors  ' + JSON.stringify(newActors));
                    }
                    values2table('actors', newActors, OnChange, tableDevicesOnReady);
                    onChange(true);
                }
                $('#checkResultActors').html(result.status);

            });
        }

        var timeout6;
        function getSensors(onChange, instance, room) {
            timeout6 = setTimeout(function () {
                getSensors(onChange, instance, room);
            }, 4000);

            var gewerk = $("#Gewerk option:selected").text();

            const data = {
                room: room,
                gewerk: gewerk
            };

            console.log('get sensors for  ' + room + " with " + gewerk + " " + JSON.stringify(data));


            //function sendTo(_adapter_instance, command, message, callback)
            sendTo(instance, 'listSensors', data, function (result) {
                if (timeout6) {
                    clearTimeout(timeout6);
                    timeout6 = null;
                }

                console.log('got sensors for  ' + room + " " + JSON.stringify(result));
                if (result.list.length > 0) {

                    var newSensors = table2values('sensors');

                    for (let i = 0; i < result.list.length; i++) {

                        const device = {
                            name: result.list[i].Name,
                            OID_Current: result.list[i].OID,
                            id: -1, //new
                            isActive: true,
                            room: result.room,
                            type: 1

                        }
                        newSensors.push(device);
                        console.log('newSensors  ' + JSON.stringify(newSensors));
                    }
                    values2table('sensors', newSensors, OnChange, tableDevicesOnReady);
                    onChange(true);
                }
                $('#checkResultSensors').html(result.status);

            });
        }



        var myOnChange = null;
        function OnChange() {
            //do nothing
            console.log('on change called');

            if (myOnChange != null) {
                myOnChange();
            }
        }


        function initDialogRoom(room, callback) {

            console.log('initDialogRoom');

            var $editDialog = $('#dialog-room-edit');
            if (!$editDialog.data('inited')) {
                $editDialog.data('inited', true);
                $editDialog.modal({
                    dismissible: false
                });

                $editDialog.find('.btn-set').on('click', function () {
                    var $editDialog = $('#dialog-room-edit');
                    var callback = $editDialog.data('callback');
                    if (typeof callback === 'function') callback();
                    $editDialog.data('callback', null);
                });
            }

            //to do fill table
            var ThermostatList4Room = [];
            var ActorList4Room = [];
            var SensorList4Room = [];

            if (DeviceList != null) {
                console.log('fill table for ' + room + " " + DeviceList.length);

                for (let i = 0; i < DeviceList.length; i++) {
                    //console.log('list entry ' + DeviceList[i].room);

                    if (DeviceList[i].room === room) {
                        if (DeviceList[i].type === 1) {
                            ThermostatList4Room.push(DeviceList[i]);
                        }
                        if (DeviceList[i].type === 2) {
                            ActorList4Room.push(DeviceList[i]);
                        }
                        if (DeviceList[i].type === 3) {
                            SensorList4Room.push(DeviceList[i]);
                        }
                    }
                }
            }
            console.log('Thermostatlist ' + JSON.stringify(ThermostatList4Room));
            console.log('Actorlist ' + JSON.stringify(ActorList4Room));
            console.log('Sensorlist ' + JSON.stringify(SensorList4Room));

            values2table('thermostats', ThermostatList4Room, OnChange, tableDevicesOnReady);
            values2table('actors', ActorList4Room, OnChange, tableDevicesOnReady);
            values2table('sensors', SensorList4Room, OnChange, tableDevicesOnReady);

            $editDialog.data('callback', callback);
            $editDialog.modal('open');

            showHideSettings();

        }



        // the function loadSettings has to exist ...
        function load(settings, onChange) {

            if (!settings) return;

            console.log('##on change');

            // example: select elements with id=key and class=value and insert value
            for (var key in settings) {
                if (!settings.hasOwnProperty(key)) continue;
                var $value = $('#' + key + '.value');
                if ($value.attr('type') === 'checkbox') {

                    $value.prop('checked', settings[key]).on('change', function () {
                        showHideSettings();
                        onChange();
                    });
                } else {
                    $value.val(settings[key]).on('change', function () {
                        console.log('on change');
                        showHideSettings();
                        onChange();
                    }).on('keyup', function () {
                        $(this).trigger('change');
                    });
                }
            }

            var $btn_check4newrooms = $('#btn_check4newrooms');
            $btn_check4newrooms.click(function () {
                console.log('check 4 new rooms');

                var _id = 'heatingcontrol.' + instance;
                console.log('my instance ' + _id);

                getRooms(onChange, _id, true);
            });




            var $btnsave_profile = $('#btn_save_profile');
            $btnsave_profile.click(function () {
                console.log('btn save profile');

                var _id = 'heatingcontrol.' + instance;
                console.log('my instance ' + _id);
                SaveProfile(_id);

            });

            var $btnload_profile = $('#btn_load_profile');
            $btnload_profile.click(function () {
                console.log('btn load profile');

                var _id = 'heatingcontrol.' + instance;
                console.log('my instance ' + _id);
                LoadProfile(_id);

            });


            myOnChange = onChange;
            // Signal to admin, that no changes yet
            onChange(false);

            $('.timepicker').timepicker({
                "twelveHour": false
            });


            showHideSettings();
            M.updateTextFields();

            var _id = 'heatingcontrol.' + instance;
            console.log('my instance ' + _id);
            getFunctions(settings.Gewerk, onChange, _id);

            if (typeof settings.devices !== 'undefined' && settings.devices != null && settings.devices.length > 0) {
                DeviceList = settings.devices;
                console.log('using devices from settings ' + JSON.stringify(DeviceList));
            }


            if (typeof settings.rooms !== 'undefined' && settings.rooms != null && settings.rooms.length > 0) {
                values2table('rooms', settings.rooms, onChange, tableRoomsOnReady);
                console.log('using rooms from settings ' + JSON.stringify(settings.rooms));
            }

            //===========================================
            //OID selecters
            $('#OID_Path2FeiertagAdapter').on('click', function () {
                initSelectId(function (sid) {
                    sid.selectId('show', $('#Path2FeiertagAdapter').val(), function (newId) {
                        if (newId) {
                            $('#Path2FeiertagAdapter').val(newId).trigger('change');
                        }
                    });
                });
            });
            $('#OID_Path2PresentDP').on('click', function () {
                initSelectId(function (sid) {
                    sid.selectId('show', $('#Path2PresentDP').val(), function (newId) {
                        if (newId) {
                            $('#Path2PresentDP').val(newId).trigger('change');
                        }
                    });
                });
            });
            $('#OID_Path2VacationDP').on('click', function () {
                initSelectId(function (sid) {
                    sid.selectId('show', $('#Path2VacationDP').val(), function (newId) {
                        if (newId) {
                            $('#Path2VacationDP').val(newId).trigger('change');
                        }
                    });
                });
            });
            $('#OID_Path2HolidayPresentDP').on('click', function () {
                initSelectId(function (sid) {
                    sid.selectId('show', $('#Path2HolidayPresentDP').val(), function (newId) {
                        if (newId) {
                            $('#Path2HolidayPresentDP').val(newId).trigger('change');
                        }
                    });
                });
            });
            $('#OID_Path2GuestsPresentDP').on('click', function () {
                initSelectId(function (sid) {
                    sid.selectId('show', $('#Path2GuestsPresentDP').val(), function (newId) {
                        if (newId) {
                            $('#Path2GuestsPresentDP').val(newId).trigger('change');
                        }
                    });
                });
            });
            $('#OID_Path2PartyNowDP').on('click', function () {
                initSelectId(function (sid) {
                    sid.selectId('show', $('#Path2PartyNowDP').val(), function (newId) {
                        if (newId) {
                            $('#Path2PartyNowDP').val(newId).trigger('change');
                        }
                    });
                });
            });

            //===========================================================================
            //maintanance functions

            $('#btn_deleteunusedDP').on('click', function () {


                sendTo(_id, 'deleteUnusedDP', null, function (result) {

                    console.log('deleteUnusedDP done ');

                    $('#result_deleteunusedDP').html(result);
                });
            });

            $('#btn_deleteunusedConfig').on('click', function () {

                DeleteUnusedConfig();


            });




            //++++++++++ TABS ++++++++++
            //Enhance Tabs with onShow-Function
            $('ul.tabs li a').on('click', function () { onTabShow($(this).attr('href')); });
            function onTabShow(tabId) {
                console.log('onTabShow');
                switch (tabId) {
                    case "#tab-main":
                        loadOptions();
                        break;

                }
            }

            function loadOptions() {
                $('.collapsible').collapsible();
            }
            loadOptions();
        }

        // ... and the function save has to exist.
        // you have to make sure the callback is called with the settings object as first param!
        function save(callback) {
            var obj = {};
            $('.value').each(function () {
                var $this = $(this);

                var id = $this.attr('id');

                if ($this.attr('type') === 'checkbox') {
                    obj[$this.attr('id')] = $this.prop('checked');
                } else {
                    obj[$this.attr('id')] = $this.val();
                }
            });

            obj.rooms = table2values('rooms');

            if (obj != null && obj.rooms != null) {
                for (let i = 0; i < obj.rooms.length; i++) {
                    console.log('check room ' + obj.rooms[i].name);
                    obj.rooms[i].name = obj.rooms[i].name.replace('.', '_');
                }
            }

            if (DeviceList != null) {
                obj.devices = DeviceList;
            }

            callback(obj);
        }

        function tableRoomsOnReady() {

            console.log('tableRoomsOnReady');

            $('#rooms .table-values-div .table-values .values-buttons[data-command="edit"]').on('click', function () {
                let id = $(this).data('index');
                let room = $('#rooms .values-input[data-name="name"][data-index="' + id + '"]').val();
                $('#dialogDeviceEditRoom').html(room);

                setTimeout(function () {
                    initDialogRoom(room, function () {

                        //this is reached when dialog is closing
                        let room = $('#dialogDeviceEditRoom')[0].innerHTML;

                        console.log('closing for ' + room);




                        let thermostats = table2values('thermostats');
                        let actors = table2values('actors');
                        let sensors = table2values('sensors');

                        console.log('Thermostatlist ' + JSON.stringify(thermostats));
                        console.log('Actorlist ' + JSON.stringify(actors));
                        console.log('Sensorlist ' + JSON.stringify(sensors));

                        //now update DeviceList
                        if (thermostats != null) {
                            for (let i = 0; i < thermostats.length; i++) {
                                //if exist, only update
                                if (thermostats[i].id > 0) {
                                    console.log("update thermostats " + JSON.stringify(thermostats[i]));
                                    DeviceList[thermostats[i].id - 1].name = thermostats[i].name;
                                    DeviceList[thermostats[i].id - 1].isActive = thermostats[i].isActive;
                                    DeviceList[thermostats[i].id - 1].OID_Target = thermostats[i].OID_Target;
                                    DeviceList[thermostats[i].id - 1].OID_Current = thermostats[i].OID_Current;
                                }
                                else {
                                    //if not exist, add at the end of list
                                    thermostats[i].id = DeviceList.length + 1;
                                    thermostats[i].type = 1;
                                    thermostats[i].room = room;
                                    console.log("add thermostats " + JSON.stringify(thermostats[i]));
                                    DeviceList.push(thermostats[i]);
                                }
                            }
                        }

                        if (actors != null) {
                            for (let i = 0; i < actors.length; i++) {
                                //if exist, only update
                                if (actors[i].id > 0) {
                                    console.log("update actors " + JSON.stringify(actors[i]));
                                    DeviceList[actors[i].id - 1].name = actors[i].name;
                                    DeviceList[actors[i].id - 1].isActive = actors[i].isActive;
                                    DeviceList[actors[i].id - 1].OID_Target = actors[i].OID_Target;
                                }
                                else {
                                    //if not exist, add at the end of list
                                    actors[i].id = DeviceList.length + 1;
                                    actors[i].type = 2;
                                    actors[i].room = room;
                                    console.log("add actors " + JSON.stringify(actors[i]));
                                    DeviceList.push(actors[i]);
                                }
                            }
                        }

                        if (sensors != null) {
                            for (let i = 0; i < sensors.length; i++) {
                                //if exist, only update
                                if (sensors[i].id > 0) {
                                    console.log("update sensors " + JSON.stringify(sensors[i]));
                                    DeviceList[sensors[i].id - 1].name = sensors[i].name;
                                    DeviceList[sensors[i].id - 1].isActive = sensors[i].isActive;
                                    DeviceList[sensors[i].id - 1].OID_Current = sensors[i].OID_Current;

                                }
                                else {
                                    //if not exist, add at the end of list
                                    sensors[i].id = DeviceList.length + 1;
                                    sensors[i].type = 3;
                                    sensors[i].room = room;
                                    console.log("add sensors " + JSON.stringify(sensors[i]));
                                    DeviceList.push(sensors[i]);
                                }
                            }
                        }

                        //find out if deleted

                        //create org list
                        var ThermostatList4Room = [];
                        var ActorList4Room = [];
                        var SensorList4Room = [];
                        for (let i = 0; i < DeviceList.length; i++) {

                            if (DeviceList[i].room === room) {
                                if (DeviceList[i].type === 1) {
                                    ThermostatList4Room.push(DeviceList[i]);
                                }
                                if (DeviceList[i].type === 2) {
                                    ActorList4Room.push(DeviceList[i]);
                                }
                                if (DeviceList[i].type === 3) {
                                    SensorList4Room.push(DeviceList[i]);
                                }
                            }
                        }
                        //check if something deleted
                        if (ThermostatList4Room.length > thermostats.length) {
                            let deletedThermostats = ThermostatList4Room.length - thermostats.length;
                            console.log("something deleted in thermostats " + deletedThermostats);

                            for (let t = 0; t < ThermostatList4Room.length; t++) {

                                let id2find = findObjectIdByKey(thermostats, 'id', ThermostatList4Room[t].id);

                                if (id2find == -1) { //not found
                                    console.log("deleted " + JSON.stringify(ThermostatList4Room[t]));
                                    let id2delete = findObjectIdByKey(DeviceList, 'id', ThermostatList4Room[t].id);
                                    DeviceList.splice(id2delete, 1);
                                }
                            }
                        }

                        if (ActorList4Room.length > actors.length) {
                            let deletedActors = ActorList4Room.length - actors.length;
                            console.log("something deleted in actors " + deletedActors);

                            for (let a = 0; a < ActorList4Room.length; a++) {

                                let id2find = findObjectIdByKey(actors, 'id', ActorList4Room[a].id);

                                if (id2find == -1) { //not found
                                    console.log("deleted " + JSON.stringify(ActorList4Room[a]));
                                    let id2delete = findObjectIdByKey(DeviceList, 'id', ActorList4Room[a].id);
                                    DeviceList.splice(id2delete, 1);
                                }
                            }
                        }
                        if (SensorList4Room.length > sensors.length) {
                            let deletedSensors = SensorList4Room.length - sensors.length;
                            console.log("something deleted in sensors " + deletedSensors);

                            for (let s = 0; s < SensorList4Room.length; s++) {

                                let id2find = findObjectIdByKey(sensors, 'id', SensorList4Room[s].id);

                                if (id2find == -1) { //not found
                                    console.log("deleted " + JSON.stringify(SensorList4Room[s]));
                                    let id2delete = findObjectIdByKey(DeviceList, 'id', SensorList4Room[s].id);
                                    DeviceList.splice(id2delete, 1);
                                }
                            }
                        }

                        //and finally rearrange id's
                        for (let i = 0; i < DeviceList.length; i++) {
                            //console.log("### " + i + " " + JSON.stringify(DeviceList[i]));
                            DeviceList[i].id = i + 1;
                            //console.log("+++ " + i + " " + JSON.stringify(DeviceList[i]));
                        }

                        console.log("new device list " + JSON.stringify(DeviceList));
                    });
                }, 20)
            });


            var $btn_check4newThermostats = $('#btn_check4newThermostats');
            $btn_check4newThermostats.click(function () {
                console.log('check 4 new Thermostats');

                var _id = 'heatingcontrol.' + instance;
                let room = $('#dialogDeviceEditRoom').html();

                console.log('my instance ' + _id + " in " + room);

                getThermostats(myOnChange, _id, room);
            });

            var $btn_check4newActors = $('#btn_check4newActors');
            $btn_check4newActors.click(function () {
                console.log('check 4 new Actors');

                var _id = 'heatingcontrol.' + instance;
                let room = $('#dialogDeviceEditRoom').html();

                console.log('my instance ' + _id + " in " + room);

                getActors(myOnChange, _id, room);
            });

            var $btn_check4newSensors = $('#btn_check4newSensors');
            $btn_check4newSensors.click(function () {
                console.log('check 4 new Sensors');

                var _id = 'heatingcontrol.' + instance;
                let room = $('#dialogDeviceEditRoom').html();

                console.log('my instance ' + _id + " in " + room);

                getSensors(myOnChange, _id, room);
            });

            showHideSettings();
        }

        function getName(obj) {

            let name = "unknown";
            if (obj && obj.common && obj.common.name) {

                if (typeof obj.common.name === 'object') {
                    name = obj.common.name[systemLang] || obj.common.name.en;
                }
                else {
                    name = obj.common.name;
                }
            } else if (obj && obj.name) {

                if (typeof obj.name === 'object') {
                    name = obj.name[systemLang] || obj.name.en;
                }
                else {
                    name = obj.name;
                }
            } else {
                var parts = obj.id.split('.');
                var last = parts.pop();
                name = last[0].toUpperCase() + last.substring(1).toLowerCase();
            }

            if (name.includes(":")) {
                var nameparts = name.split(':');
                name = nameparts[0];
            }

            return name;

        }

        function getOID(obj) {
            let OID = "unknown";
            if (obj && obj._id) {
                OID = obj._id;
            }

            return OID;

        }


        function tableDevicesOnReady() {

            console.log('tableDevicesOnReady');

            $('#thermostats .table-values-div .table-values .values-buttons[data-command="edit1"]').on('click', function () {

                let id = $(this).data('index');

                console.log('edit thermostats clicked ID=' + id);

                initSelectId(function (sid) {
                    sid.selectId('show', $('#thermostats .values-input[data-name="name"][data-index="' + id + '"]').val(), function (newId) {
                        if (newId) {
                            $('#thermostats .values-input[data-name="name"][data-index="' + id + '"]').val(newId).trigger('change');
                            socket.emit('getObject', newId, function (err, obj) {
                                let name = getName(obj);

                                let OID_Current = getOID(obj);

                                $('#thermostats .values-input[data-name="OID_Current"][data-index="' + id + '"]').val(OID_Current).trigger('change');

                            });
                        }
                    });
                });


            });

            $('#thermostats .table-values-div .table-values .values-buttons[data-command="edit2"]').on('click', function () {

                let id = $(this).data('index');

                console.log('edit thermostats clicked ID=' + id);

                initSelectId(function (sid) {
                    sid.selectId('show', $('#thermostats .values-input[data-name="name"][data-index="' + id + '"]').val(), function (newId) {
                        if (newId) {
                            $('#thermostats .values-input[data-name="name"][data-index="' + id + '"]').val(newId).trigger('change');
                            socket.emit('getObject', newId, function (err, obj) {
                                let name = getName(obj);

                                let OID_Target = getOID(obj);

                                $('#thermostats .values-input[data-name="name"][data-index="' + id + '"]').val(name).trigger('change');
                                $('#thermostats .values-input[data-name="OID_Target"][data-index="' + id + '"]').val(OID_Target).trigger('change');

                            });
                        }
                    });
                });


            });

            $('#actors .table-values-div .table-values .values-buttons[data-command="edit"]').on('click', function () {

                let id = $(this).data('index');

                console.log('edit actors clicked ID=' + id);

                initSelectId(function (sid) {
                    sid.selectId('show', $('#actors .values-input[data-name="name"][data-index="' + id + '"]').val(), function (newId) {
                        if (newId) {
                            $('#actors .values-input[data-name="name"][data-index="' + id + '"]').val(newId).trigger('change');
                            socket.emit('getObject', newId, function (err, obj) {
                                var name = getName(obj);

                                var OID_Target = getOID(obj);
                                $('#actors .values-input[data-name="name"][data-index="' + id + '"]').val(name).trigger('change');
                                $('#actors .values-input[data-name="OID_Target"][data-index="' + id + '"]').val(OID_Target).trigger('change');
                            });
                        }
                    });
                });
            });

            $('#sensors .table-values-div .table-values .values-buttons[data-command="edit"]').on('click', function () {

                let id = $(this).data('index');

                console.log('edit sensors clicked ID=' + id);

                initSelectId(function (sid) {
                    sid.selectId('show', $('#sensors .values-input[data-name="name"][data-index="' + id + '"]').val(), function (newId) {
                        if (newId) {
                            $('#sensors .values-input[data-name="name"][data-index="' + id + '"]').val(newId).trigger('change');
                            socket.emit('getObject', newId, function (err, obj) {
                                var name = getName(obj);
                                var OID_Current = getOID(obj);
                                $('#sensors .values-input[data-name="name"][data-index="' + id + '"]').val(name).trigger('change');
                                $('#sensors .values-input[data-name="OID_Current"][data-index="' + id + '"]').val(OID_Current).trigger('change');
                            });
                        }
                    });
                });
            });

            showHideSettings();

        }

        var selectId;
        function initSelectId(callback) {
            if (selectId) {
                return callback(selectId);
            }
            socket.emit('getObjects', function (err, objs) {
                selectId = $('#dialog-select-member').selectId('init', {
                    noMultiselect: true,
                    objects: objs,
                    imgPath: '../../lib/css/fancytree/',
                    filter: { type: 'state' },
                    name: 'scenes-select-state',
                    texts: {
                        select: _('Select'),
                        cancel: _('Cancel'),
                        all: _('All'),
                        id: _('ID'),
                        name: _('Name'),
                        role: _('Role'),
                        room: _('Room'),
                        value: _('Value'),
                        selectid: _('Select ID'),
                        from: _('From'),
                        lc: _('Last changed'),
                        ts: _('Time stamp'),
                        wait: _('Processing...'),
                        ack: _('Acknowledged'),
                        selectAll: _('Select all'),
                        unselectAll: _('Deselect all'),
                        invertSelection: _('Invert selection')
                    },
                    columns: ['image', 'name', 'role', 'room']
                });
                callback(selectId);
            });
        }


    </script>
</head>
<body>
    <!-- you have to put your config page in a div with id adapter-container -->
    <div class="m adapter-container">

        <div class="row">
            <div class="col s12">
                <ul class="tabs">
                    <li class="tab col s2"><a href="#tab-main" class="translate active">Main settings</a></li>
                    <li class="tab col s2 le-settings"><a href="#tab-profiles" class="translate">profile</a></li>
                    <li class="tab col s2 le-settings"><a href="#tab-devices" class="translate">devices</a></li>
                </ul>
            </div>

            <!-- tab "main - settings"  -->
            <div id="tab-main" class="col s12 page">
                <div class="row">
                    <div class="col s6 m4 l2">
                        <img src="heatingcontrol.png" class="logo">
                    </div>

                    <div class="col s6 col-adapternotonline">
                        <span class="translate">AdapterNotOnline</span>
                    </div>
                </div>



                <ul class="collapsible">
                    <li>
                        <div class="collapsible-header">
                            <i class="material-icons">expand_more</i><h6 class="translate">GeneralSettings</h6>
                        </div>
                        <div class="collapsible-body">
                            <div class="row">

                                <div class="input-field col s6">
                                    <select id="Gewerk" class="value">
                                        <option value="1" class="translate">nothing</option>
                                    </select>
                                    <label for="Gewerk" class="translate">Gewerk</label>
                                </div>
                            </div>

                            <div class="row">
                                <div class="input-field col s6">
                                    <input type="text" id="timezone" class="value" />
                                    <label for="timezone" class="translate">timezone</label>
                                </div>
                            </div>
                        </div>
                    </li>

                    <li>
                        <div class="collapsible-header">
                            <i class="material-icons">expand_more</i><h6 class="translate">DPSettings</h6>
                        </div>
                        <div class="collapsible-body">
                            <div class="row">
                                <div class="input-field col s4">
                                    <input type="text" id="Path2FeiertagAdapter" class="value" />
                                    <label for="Path2FeiertagAdapter" class="translate">Path2FeiertagAdapter</label>

                                </div>
                                <div class="col s1 m2 l1">
                                    <a id="OID_Path2FeiertagAdapter" class="btn-floating waves-effect waves-light blue table-button-add"><i class="material-icons">add</i></a>
                                </div>
                            </div>

                            <div class="row">
                                <div class="input-field col s4">
                                    <input type="text" id="Path2PresentDP" class="value" />
                                    <label for="Path2PresentDP" class="translate">Path2PresentDP</label>

                                </div>
                                <div class="col s1 m2 l1">
                                    <a id="OID_Path2PresentDP" class="btn-floating waves-effect waves-light blue table-button-add"><i class="material-icons">add</i></a>
                                </div>

                                <div class="input-field col s3">
                                    <select id="Path2PresentDPType" class="value">
                                        <option value="1" class="translate">boolean</option>
                                        <option value="2" class="translate">number</option>
                                    </select>
                                    <label for="Path2PresentDPType" class="translate">Path2PresentDPType</label>
                                </div>


                                <div class="input-field col s3 col_Path2PresentDPLimit">
                                    <input type="number" id="Path2PresentDPLimit" class="value" min="0" step="1" />
                                    <label for="Path2PresentDPLimit" class="translate">Path2PresentDPLimit</label>

                                </div>


                            </div>

                            <div class="row">
                                <div class="input-field col s4">
                                    <input type="text" id="Path2VacationDP" class="value" />
                                    <label for="Path2VacationDP" class="translate">Path2VacationDP</label>

                                </div>
                                <div class="col s1 m2 l1">
                                    <a id="OID_Path2VacationDP" class="btn-floating waves-effect waves-light blue table-button-add"><i class="material-icons">add</i></a>
                                </div>
                            </div>

                            <div class="row">
                                <div class="input-field col s4">
                                    <input type="text" id="Path2HolidayPresentDP" class="value" />
                                    <label for="Path2HolidayPresentDP" class="translate">Path2HolidayPresentDP</label>

                                </div>
                                <div class="col s1 m2 l1">
                                    <a id="OID_Path2HolidayPresentDP" class="btn-floating waves-effect waves-light blue table-button-add"><i class="material-icons">add</i></a>
                                </div>
                            </div>

                            <div class="row">
                                <div class="input-field col s4">
                                    <input type="text" id="Path2GuestsPresentDP" class="value" />
                                    <label for="Path2GuestsPresentDP" class="translate">Path2GuestsPresentDP</label>

                                </div>
                                <div class="col s1 m2 l1">
                                    <a id="OID_Path2GuestsPresentDP" class="btn-floating waves-effect waves-light blue table-button-add"><i class="material-icons">add</i></a>
                                </div>

                                <div class="input-field col s3">
                                    <select id="Path2GuestsPresentDPType" class="value">
                                        <option value="1" class="translate">boolean</option>
                                        <option value="2" class="translate">number</option>
                                    </select>
                                    <label for="Path2GuestsPresentDPType" class="translate">Path2GuestsPresentDPType</label>
                                </div>


                                <div class="input-field col s3 col_Path2GuestsPresentDPLimit">
                                    <input type="number" id="Path2GuestsPresentDPLimit" class="value" min="0" step="1" />
                                    <label for="Path2GuestsPresentDPLimit" class="translate">Path2GuestsPresentDPLimit</label>
                                </div>


                            </div>

                            <div class="row">
                                <div class="input-field col s4">
                                    <input type="text" id="Path2PartyNowDP" class="value" />
                                    <label for="Path2PartyNowDP" class="translate">Path2PartyNowDP</label>

                                </div>
                                <div class="col s1 m2 l1">
                                    <a id="OID_Path2PartyNowDP" class="btn-floating waves-effect waves-light blue table-button-add"><i class="material-icons">add</i></a>
                                </div>

                                <div class="input-field col s3">
                                    <select id="Path2PartyNowDPType" class="value">
                                        <option value="1" class="translate">boolean</option>
                                        <option value="2" class="translate">number</option>
                                    </select>
                                    <label for="Path2PartyNowDPType" class="translate">Path2PartyNowDPType</label>
                                </div>


                                <div class="input-field col s3 col_Path2PartyNowDPLimit">
                                    <input type="number" id="Path2PartyNowDPLimit" class="value" min="0" step="1" />
                                    <label for="Path2PartyNowDPLimit" class="translate">Path2PartyNowDPLimit</label>
                                </div>

                            </div>
                        </div>
                    </li>


                    <li>
                        <div class="collapsible-header">
                            <i class="material-icons">expand_more</i><h6 class="translate">ThermostatSettings</h6>
                        </div>
                        <div class="collapsible-body">
                            <div class="row">
                                <div class="input-field col s6 col-usechangesfromthermostat">
                                    <select id="UseChangesFromThermostat" class="value">
                                        <option value="1" class="translate">no</option>
                                        <option value="2" class="translate">as_override</option>
                                        <option value="3" class="translate">as_new_profile_setting</option>
                                        <option value="5" class="translate">until_next_profile_point</option>
                                    </select>
                                    <label for="UseChangesFromThermostat" class="translate">UseChangesFromThermostat</label>
                                </div>
                            </div>

                            <div class="row">
                                <div class="input-field col s6">
                                    <input type="checkbox" id="ExtendOverride" class="value" />
                                    <label for="ExtendOverride" class="translate">ExtendOverride</label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="input-field col s6">
                                    <input type="checkbox" id="ThermostatHandlesWindowOpen" class="value" />
                                    <label for="ThermostatHandlesWindowOpen" class="translate">ThermostatHandlesWindowOpen</label>
                                </div>
                            </div>

                        </div>
                    </li>
                    <li>
                        <div class="collapsible-header">
                            <i class="material-icons">expand_more</i><h6 class="translate">SensorSettings</h6>
                        </div>
                        <div class="collapsible-body">
                            <div class="row">
                                <div class="input-field col s6">
                                    <input type="checkbox" id="UseSensors" class="value" />
                                    <label for="UseSensors" class="translate">use_sensors</label>
                                </div>

                                <div class="input-field col s3 col-SensorOpenDelay">
                                    <input type="number" id="SensorOpenDelay" class="value" min="0" step="1" />
                                    <label for="SensorOpenDelay" class="translate">SensorOpenDelay</label>
                                </div>

                                <div class="input-field col s3 col-SensorCloseDelay">
                                    <input type="number" id="SensorCloseDelay" class="value" min="0" step="1" />
                                    <label for="SensorCloseDelay" class="translate">SensorCloseDelay</label>
                                </div>

                            </div>
                        </div>
                    </li>

                    <li>
                        <div class="collapsible-header">
                            <i class="material-icons">expand_more</i><h6 class="translate">ActorSettings</h6>
                        </div>
                        <div class="collapsible-body">
                            <div class="row">
                                <div class="input-field col s6">
                                    <input type="checkbox" id="UseActors" class="value" />
                                    <label for="UseActors" class="translate">use_actors</label>
                                </div>

                                <div class="input-field col s3 col-ActorOnDelay">
                                    <input type="number" id="ActorBeforeOnDelay" class="value" min="0" step="1" />
                                    <label for="ActorBeforeOnDelay" class="translate">ActorBeforeOnDelay</label>
                                </div>

                                <div class="input-field col s3 col-ActorOffDelay">
                                    <input type="number" id="ActorBeforeOffDelay" class="value" min="0" step="1" />
                                    <label for="ActorBeforeOffDelay" class="translate">ActorBeforeOffDelay</label>
                                </div>

                            </div>



                            <div class="row">
                                <div class="input-field col s6 col-useactorifnoheating">
                                    <select id="UseActorsIfNotHeating" class="value">
                                        <option value="1" class="translate">nothing</option>
                                        <option value="2" class="translate">off</option>
                                        <option value="3" class="translate">on</option>
                                    </select>
                                    <label for="UseActorsIfNotHeating" class="translate">UseActorsIfNotHeating</label>
                                </div>
                                <div class="input-field col s6 col-useactorifnothermostat">
                                    <select id="UseActorsIfNoThermostat" class="value">
                                        <option value="1" class="translate">nothing</option>
                                        <option value="2" class="translate">off</option>
                                        <option value="3" class="translate">on</option>
                                    </select>
                                    <label for="UseActorsIfNoThermostat" class="translate">UseActorsIfNoThermostat</label>
                                </div>
                            </div>


                        </div>
                    </li>

                    <li>
                        <div class="collapsible-header">
                            <i class="material-icons">expand_more</i><h6 class="translate">VisSettings</h6>
                        </div>
                        <div class="collapsible-body">
                            <div class="row">
                                <div class="input-field col s6 col-usevisfrompittini">
                                    <input type="checkbox" id="UseVisFromPittini" class="value" />
                                    <label for="UseVisFromPittini" class="translate">UseVisFromPittini</label>
                                </div>

                                <div class="col s6 col-use-custom-path-descr">
                                    <span class="translate">hint_vis_from_Pittini</span>
                                </div>


                            </div>

                            <div class="row">
                                <div class="input-field col s6 col-VisUseSimple">
                                    <input type="checkbox" id="VisUseSimple" class="value" />
                                    <label for="VisUseSimple" class="translate">VisUseSimple</label>
                                </div>

                            </div>

                            <div class="row">
                                <div class="input-field col s3 col-PittiniPathImageWindowOpen">
                                    <input type="text" id="PittiniPathImageWindowOpen" class="value" />
                                    <label for="PittiniPathImageWindowOpen" class="translate">PittiniPathImageWindowOpen</label>
                                </div>
                                <div class="input-field col s3 col-PittiniPathImageWindowClosed">
                                    <input type="text" id="PittiniPathImageWindowClosed" class="value" />
                                    <label for="PittiniPathImageWindowClosed" class="translate">PittiniPathImageWindowClosed</label>
                                </div>



                            </div>


                            <div class="row">
                                <div class="input-field col s3 col-VisMinProfilTemp">
                                    <input type="number" id="VisMinProfilTemp" min="0" max="20" class="value" />
                                    <label for="VisMinProfilTemp" class="translate">VisMinProfilTemp</label>
                                </div>
                                <div class="input-field col s3 col-VisMaxProfilTemp">
                                    <input type="number" id="VisMaxProfilTemp" min="10" max="30" class="value" />
                                    <label for="VisMaxProfilTemp" class="translate">VisMaxProfilTemp</label>
                                </div>

                                <div class="input-field col s3 col-VisStepWidthProfilTemp">
                                    <select id="VisStepWidthProfilTemp" class="value">
                                        <option value="0.5" class="translate">0.5 °C</option>
                                        <option value="1" class="translate">1 °C</option>
                                        <option value="2" class="translate">2 °C</option>
                                    </select>
                                    <label for="VisStepWidthProfilTemp" class="translate">VisStepWidthProfilTemp</label>
                                </div>

                            </div>

                            <div class="row">
                                <div class="input-field col s3 col-VisMinDecRelTemp">
                                    <input type="number" id="VisMinDecRelTemp" min="1" max="10" class="value" />
                                    <label for="VisMinDecRelTemp" class="translate">VisMinDecRelTemp</label>
                                </div>
                                <div class="input-field col s3 col-VisMaxDecRelTemp">
                                    <input type="number" id="VisMaxDecRelTemp" min="2" max="20" class="value" />
                                    <label for="VisMaxProfilTemp" class="translate">VisMaxDecRelTemp</label>
                                </div>

                                <div class="input-field col s3 col-VisStepWidthDecRelTemp">
                                    <select id="VisStepWidthDecRelTemp" class="value">
                                        <option value="0.5" class="translate">0.5 °C</option>
                                        <option value="1" class="translate">1 °C</option>
                                        <option value="2" class="translate">2 °C</option>
                                    </select>
                                    <label for="VisStepWidthDecRelTemp" class="translate">VisStepWidthDecRelTemp</label>
                                </div>

                            </div>

                            <div class="row">
                                <div class="input-field col s3 col-VisMinDecAbsTemp">
                                    <input type="number" id="VisMinDecAbsTemp" min="3" max="20" class="value" />
                                    <label for="VisMinDecAbsTemp" class="translate">VisMinDecAbsTemp</label>
                                </div>
                                <div class="input-field col s3 col-VisMaxDecAbsTemp">
                                    <input type="number" id="VisMaxDecAbsTemp" min="5" max="30" class="value" />
                                    <label for="VisMaxDecAbsTemp" class="translate">VisMaxDecAbsTemp</label>
                                </div>

                                <div class="input-field col s3 col-VisStepWidthDecAbsTemp">
                                    <select id="VisStepWidthDecAbsTemp" class="value">
                                        <option value="0.5" class="translate">0.5 °C</option>
                                        <option value="1" class="translate">1 °C</option>
                                        <option value="2" class="translate">2 °C</option>
                                    </select>
                                    <label for="VisStepWidthDecAbsTemp" class="translate">VisStepWidthDecAbsTemp</label>
                                </div>

                            </div>

                            <div class="row">
                                <div class="input-field col s3 col-VisMinOverrideTemp">
                                    <input type="number" id="VisMinOverrideTemp" min="3" max="25" class="value" />
                                    <label for="VisMinOverrideTemp" class="translate">VisMinOverrideTemp</label>
                                </div>
                                <div class="input-field col s3 col-VisMaxOverrideTemp">
                                    <input type="number" id="VisMaxOverrideTemp" min="5" max="35" class="value" />
                                    <label for="VisMaxOverrideTemp" class="translate">VisMaxOverrideTemp</label>
                                </div>

                                <div class="input-field col s3 col-VisStepWidthOverrideTemp">
                                    <select id="VisStepWidthOverrideTemp" class="value">
                                        <option value="0.5" class="translate">0.5 °C</option>
                                        <option value="1" class="translate">1 °C</option>
                                        <option value="2" class="translate">2 °C</option>
                                    </select>
                                    <label for="VisStepWidthOverrideTemp" class="translate">VisStepWidthOverrideTemp</label>
                                </div>

                            </div>

                        </div>
                    </li>

                    <li>
                        <div class="collapsible-header">
                            <i class="material-icons">expand_more</i><h6 class="translate">Maintenance</h6>
                        </div>
                        <div class="collapsible-body">
                            <div class="row">
                                <a class="waves-effect waves-light btn" id="btn_deleteunusedDP"><span class="translate">DeleteUnusedDP</span></a>
                                <div id="result_deleteunusedDP"></div>
                            </div>
                            <div class="row">
                                <a class="waves-effect waves-light btn" id="btn_deleteunusedConfig"><span class="translate">DeleteUnusedConfig</span></a>
                                <div id="result_deleteunusedConfig"></div>
                            </div>

                        </div>
                    </li>
                </ul>
            </div>

            <!-- tab "profile - settings"  -->
            <div id="tab-profiles" class="col s12 page">

                <ul class="collapsible">
                    <li>
                        <div class="collapsible-header">
                            <i class="material-icons">expand_more</i><h6 class="translate">GeneralProfileSettings</h6>
                        </div>
                        <div class="collapsible-body">

                            <div class="row">
                                <div class="input-field col s1">
                                    <a class="btn-floating btn-small translateT" title="save profile" id="btn_save_profile"><i class="material-icons">file_download</i></a>
                                </div>
                                <div class="input-field col s1">
                                    <a class="btn-floating btn-small translateT" title="load profile" id="btn_load_profile"><i class="material-icons">file_upload</i></a>
                                </div>
                                <div id="checkResultSaveProfile"></div>
                                <div id="checkResultLoadProfile"></div>
                            </div>


                            <div class="row">
                                <div class="input-field col s4">
                                    <select id="ProfileType" class="value">
                                        <option value="1" class="translate">Mo-So</option>
                                        <option value="2" class="translate">Mo-Fr + Sa-So</option>
                                        <option value="3" class="translate">every Day</option>
                                    </select>
                                    <label for="ProfileType" class="translate">ProfileType</label>
                                </div>

                                <div class="input-field col s4">
                                    <input type="number" id="NumberOfProfiles" min="1" max="10" class="value" />
                                    <label for="NumberOfProfiles" class="translate">NumberOfProfiles</label>
                                </div>

                                <div class="input-field col s4">
                                    <input type="number" id="NumberOfPeriods" min="1" max="10" class="value" />
                                    <label for="NumberOfPeriods" class="translate">NumberOfPeriods</label>
                                </div>
                            </div>

                            <div class="row">
                                <div class="input-field col s4">
                                    <input type="checkbox" id="PublicHolidayLikeSunday" class="value" />
                                    <label for="PublicHolidayLikeSunday" class="translate">PublicHolidayLikeSunday</label>
                                </div>
                            </div>

                            <div class="row">
                                <div class="input-field col s4">
                                    <input type="checkbox" id="HolidayPresentLikeSunday" class="value" />
                                    <label for="HolidayPresentLikeSunday" class="translate">HolidayPresentLikeSunday</label>
                                </div>
                            </div>


                            <div class="row">
                                <div class="input-field col s4">
                                    <select id="TemperatureDecrease" class="value">
                                        <option value="1" class="translate">relative</option>
                                        <option value="2" class="translate">absolute</option>
                                        <option value="3" class="translate">no lowering</option>
                                    </select>
                                    <label for="TemperatureDecrease" class="translate">TemperatureDecrease</label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="input-field col s4">
                                    <input type="checkbox" id="UseMinTempPerRoom" class="value" />
                                    <label for="UseMinTempPerRoom" class="translate">UseMinTempPerRoom</label>
                                </div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="collapsible-header">
                            <i class="material-icons">expand_more</i><h6 class="translate">HeatingperiodSettings</h6>
                        </div>
                        <div class="collapsible-body">

                            <div class="row">
                                <div class="input-field col s4">
                                    <input type="checkbox" id="UseFixHeatingPeriod" class="value" />
                                    <label for="UseFixHeatingPeriod" class="translate">UseFixHeatingPeriod</label>
                                </div>

                                <div class="input-field col s4 col-FixHeatingPeriod-Start">
                                    <input type="text" id="FixHeatingPeriodStart" class="value" maxlength="6" />
                                    <label for="FixHeatingPeriodStart" class="translate">FixHeatingPeriodStart</label>
                                </div>

                                <div class="input-field col s4 col-FixHeatingPeriod-End">
                                    <input type="text" id="FixHeatingPeriodEnd" class="value" maxlength="6" />
                                    <label for="FixHeatingPeriodEnd" class="translate">FixHeatingPeriodEnd</label>
                                </div>

                            </div>

                            <div class="row">
                                <div class="input-field col s4 col-thermostattodeifnoheatingperiod">
                                    <select id="ThermostatModeIfNoHeatingperiod" class="value">
                                        <option value="1" class="translate">fixTempPerRoom</option>
                                        <option value="2" class="translate">fixTempForAll</option>
                                        <option value="3" class="translate">nothing</option>
                                    </select>
                                    <label for="ThermostatModeIfNoHeatingperiod" class="translate">ThermostatModeIfNoHeatingperiod</label>
                                </div>

                                <div class="input-field col s4 col-FixTempIfNoHeatingPeriod">
                                    <input type="number" id="FixTempIfNoHeatingPeriod" class="value" />
                                    <label for="FixTempIfNoHeatingPeriod" class="translate">FixTempIfNoHeatingPeriod</label>
                                </div>

                            </div>
                        </div>
                    </li>

                </ul>

            </div>

            <!-- tab "devices" -->
            <div id="tab-devices" class="col s12 page">

                <div class="row">
                    <div class="input-field col s4">
                        <a class="waves-effect waves-light btn" id="btn_check4newrooms"><span class="translate">Check4NewRooms</span></a>
                        <div id="checkResultRooms"></div>
                    </div>
                    <div class="input-field col s4">
                        <span class="translate">Check4NewRooms_hint</span>
                    </div>
                </div>

                <div class="col s12" id="rooms">

                    <a class="btn-floating waves-effect waves-light blue table-button-add"><i class="material-icons">add</i></a>

                    <div class="table-values-div">
                        <table id="table_rooms" class="table-values" style="width: 100%;">
                            <thead>
                                <tr>
                                    <th id="rooms_col_1" data-name="name" style="width: 20%; background: #64b5f6 " class="translate">room</th>
                                    <th id="rooms_col_2" data-name="isActive" data-type="checkbox" style="background: #64b5f6" class="translate">active</th>
                                    <th data-buttons="up down edit delete" style="width: 100px; background: #64b5f6"></th>

                                </tr>
                            </thead>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div class="m material-dialogs">
            <div id="dialog-select-member" class="modal modal-fixed-footer">
                <div class="modal-content">
                    <div class="row">
                        <div class="col s12 title"></div>
                    </div>
                    <div class="row">
                        <div class="col s12 dialog-content">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <a class="modal-action modal-close waves-effect waves-green btn btn-set"><i class="large material-icons left">check</i><span class="translate">Select</span></a>
                    <a class="modal-action modal-close waves-effect waves-green btn btn-close"><i class="large material-icons left ">close</i><span class="translate">Cancel</span></a>
                </div>
            </div>
            <div id="dialog-room-edit" class="modal modal-fixed-footer">
                <div class="row">
                    <div class="modal-content">

                        <div class="row">
                            <div class="col s12">
                                <h6 class="title"><span class="translate">Edit Room:</span> <span id="dialogDeviceEditRoom"></span></h6>
                            </div>
                        </div>
                        <div class="col s12">
                            <ul class="tabs">
                                <li id="page-thermostats" class="tab col s4"><a href="#tab-popup_thermostats" class="translate active">thermostats</a></li>
                                <li id="page-actors" class="tab col s4"><a href="#tab-popup_actors" class="translate">actors</a></li>
                                <li id="page-sensors" class="tab col s4"><a href="#tab-popup_sensors" class="translate">sensors</a></li>
                            </ul>
                        </div>
                        <div id="tab-popup_thermostats" class="col s12 page">
                            <div class="row">
                                <div class="col s12 ">
                                    <span class="translate">hint_thermostats</span>
                                </div>
                            </div>

                            <div class="row">
                                <div class="input-field col s4">
                                    <a class="waves-effect waves-light btn" id="btn_check4newThermostats"><span class="translate">Check4NewThermostats</span></a>
                                    <div id="checkResultThermostats"></div>
                                </div>
                                <div class="input-field col s4">
                                    <span class="translate">Check4NewThermostats_hint</span>
                                </div>
                            </div>


                            <div class="row">
                                <div class="col s12" id="thermostats">
                                    <a class="btn-floating waves-effect waves-light blue table-button-add"><i class="material-icons">add</i></a>

                                    <div class="table-values-div">
                                        <table id="table_thermostats" class="table-values" style="width: 100%;">
                                            <thead>
                                                <tr>
                                                    <th id="thermostat_col_0" data-name="id" style="background: #64b5f6;" class="translate">id</th>

                                                    <th id="thermostat_col_1" data-name="name" style="background: #64b5f6" class="translate">thermostat</th>
                                                    <th id="thermostat_col_2" data-name="OID_Current" style="background: #64b5f6" class="translate">OID current</th>
                                                    <th id="thermostat_edit1" data-buttons="edit1" style="width: 100px; background: #64b5f6"></th>
                                                    <th id="thermostat_col_3" data-name="OID_Target" style="background: #64b5f6" class="translate">OID target</th>
                                                    <th id="thermostat_edit2" data-buttons="edit2" style="width: 100px; background: #64b5f6"></th>
                                                    <th data-name="isActive" data-type="checkbox" style="background: #64b5f6" class="translate">active</th>
                                                    <th data-buttons="delete" style="width: 100px; background: #64b5f6"></th>

                                                </tr>
                                            </thead>
                                        </table>
                                    </div>
                                </div>
                            </div>

                        </div>
                        <div id="tab-popup_actors" class="col s12 page">
                            <div class="row">
                                <div class="col s12 ">
                                    <span class="translate">hint_actors</span>
                                </div>
                            </div>
                            <div class="row">
                                <div class="input-field col s4">
                                    <a class="waves-effect waves-light btn" id="btn_check4newActors"><span class="translate">Check4NewActors</span></a>
                                    <div id="checkResultActors"></div>
                                </div>
                                <div class="input-field col s4">
                                    <span class="translate">Check4NewActors_hint</span>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col s12" id="actors">
                                    <a class="btn-floating waves-effect waves-light blue table-button-add"><i class="material-icons">add</i></a>
                                    <div class="table-values-div">
                                        <table id="table_actors" class="table-values" style="width: 100%;">
                                            <thead>
                                                <tr>
                                                    <th id="actor_col_0" data-name="id" style="background: #64b5f6;" class="translate">id</th>
                                                    <th id="actor_col_1" data-name="name" style="background: #64b5f6" class="translate">actor</th>
                                                    <th id="actor_col_2" data-name="OID_Target" style="background: #64b5f6" class="translate">OID</th>
                                                    <th data-buttons="edit" style="width: 100px; background: #64b5f6"></th>
                                                    <th data-name="isActive" data-type="checkbox" style="background: #64b5f6" class="translate">active</th>
                                                    <th data-buttons="delete" style="width: 100px; background: #64b5f6"></th>
                                                </tr>
                                            </thead>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="tab-popup_sensors" class="col s12 page">
                            <div class="row">
                                <div class="col s12 ">
                                    <span class="translate">hint_sensors</span>
                                </div>
                            </div>

                            <div class="row">
                                <div class="input-field col s4">
                                    <a class="waves-effect waves-light btn" id="btn_check4newSensors"><span class="translate">Check4NewSensors</span></a>
                                    <div id="checkResultSensors"></div>
                                </div>
                                <div class="input-field col s4">
                                    <span class="translate">Check4NewSensors_hint</span>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col s12" id="sensors">
                                    <a class="btn-floating waves-effect waves-light blue table-button-add"><i class="material-icons">add</i></a>
                                    <div class="table-values-div">
                                        <table id="table_sensors" class="table-values" style="width: 100%;">
                                            <thead>
                                                <tr>
                                                    <th id="sensor_col_0" data-name="id" style="background: #64b5f6;" class="translate">id</th>
                                                    <th id="sensor_col_1" data-name="name" style="background: #64b5f6" class="translate">sensor</th>
                                                    <th id="sensor_col_2" data-name="OID_Current" style="background: #64b5f6" class="translate">OID</th>
                                                    <th data-buttons="edit" style="width: 100px; background: #64b5f6"></th>
                                                    <th data-name="isActive" data-type="checkbox" style="background: #64b5f6" class="translate">active</th>
                                                    <th data-buttons="delete" style="width: 100px; background: #64b5f6"></th>

                                                </tr>
                                            </thead>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <a class="modal-action modal-close waves-effect waves-green btn btn-set"><i class="large material-icons left">check</i><span class="translate">Ok</span></a>
                    <a class="modal-action modal-close waves-effect waves-green btn btn-close"><i class="large material-icons left">close</i><span class="translate">Cancel</span></a>
                </div>
            </div>
        </div>

    </div>
</body>
</html>
